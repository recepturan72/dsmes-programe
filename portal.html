
<!DOCTYPE html>
<html lang='tr'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Diyabet Portal</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
  <style>
    body{font-family:Arial, sans-serif;margin:20px;}
    nav button{margin-right:10px;padding:8px 12px;}
    .tab{display:none;margin-top:20px;}
    .visible{display:block;}
    form input, form select{margin:4px 0;padding:6px;}
    .record, .entry{border-bottom:1px solid #ccc;padding:4px 0;}
  </style>
</head>
<body>
  <h2>🔑 Diyabet Hasta Portalı</h2>
  <div id="loginDiv">
    <input type="email" id="email" placeholder="E-posta"><br>
    <input type="password" id="password" placeholder="Şifre"><br>
    <button onclick="kayitOl()">Kayıt Ol</button>
    <button onclick="girisYap()">Giriş Yap</button>
  </div>

  <div id="portal" style="display:none;">
    <button onclick="cikisYap()">🚪 Çıkış</button>
    <nav>
      <button onclick="showTab('seker')">📊 Kan Şekeri</button>
      <button onclick="showTab('tanitici')">📑 Tanıtıcı Bilgi</button>
      <button onclick="showTab('doys')">📑 DÖYS</button>
      <button onclick="showTab('dds')">📑 DDS</button>
    </nav>

    <div id="seker" class="tab">
      <h3>📊 Kan Şekeri Takibi</h3>
      <input type="number" id="glucose" placeholder="Kan Şekeri (mg/dl)"><br>
      <input type="text" id="note" placeholder="Not (örn. kahvaltı sonrası)"><br>
      <button onclick="kaydetSeker()">Kaydet</button>
      <h4>Geçmiş Ölçümlerim:</h4>
      <div id="sekerList"></div>
    </div>

    <div id="tanitici" class="tab">
      <h3>📑 Tanıtıcı Bilgi Formu</h3>
      <form id="taniticiForm">
        <label>Cinsiyet: 
          <select name="cinsiyet">
            <option>Kadın</option><option>Erkek</option>
          </select>
        </label><br>
        <label>Yaş: <input type="number" name="yas"></label><br>
        <label>Eğitim: 
          <select name="egitim">
            <option>İlköğretim</option><option>Lise</option><option>Üniversite</option><option>Lisansüstü</option>
          </select>
        </label><br>
        <button type="button" onclick="kaydetForm('Tanıtıcı')">Kaydet</button>
      </form>
      <div id="taniticiList"></div>
    </div>

    <div id="doys" class="tab">
      <h3>📑 Diyabet Öz Yönetim Skalası (DÖYS)</h3>
      <form id="doysForm">
        <p>1- Kan şekeri seviyemi özenle ve dikkatle kontrol ediyorum. 
        <select name="q1"><option>3</option><option>2</option><option>1</option><option>0</option></select></p>
        <!-- Benzer şekilde 16 madde eklenebilir, burada örnek 1 gösteriliyor -->
        <button type="button" onclick="kaydetForm('DÖYS')">Kaydet</button>
      </form>
      <div id="doysList"></div>
    </div>

    <div id="dds" class="tab">
      <h3>📑 Diyabet Distres Ölçeği (DDS)</h3>
      <form id="ddsForm">
        <p>1- Diyabetimi yönetirken stres hissediyorum.
        <select name="q1"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select></p>
        <!-- Benzer şekilde 8 madde eklenebilir, burada örnek 1 gösteriliyor -->
        <button type="button" onclick="kaydetForm('DDS')">Kaydet</button>
      </form>
      <div id="ddsList"></div>
    </div>

  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB88e2t5AgqdhHFtb_a2konmaE2HHahiGk",
      authDomain: "diyabetportal.firebaseapp.com",
      projectId: "diyabetportal",
      storageBucket: "diyabetportal.firebasestorage.app",
      messagingSenderId: "771103540098",
      appId: "1:771103540098:web:d1031e184531d4f3ea459b"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    function kayitOl(){
      auth.createUserWithEmailAndPassword(
        document.getElementById('email').value,
        document.getElementById('password').value
      ).catch(e=>alert(e.message));
    }
    function girisYap(){
      auth.signInWithEmailAndPassword(
        document.getElementById('email').value,
        document.getElementById('password').value
      )
      .then(()=>{
        document.getElementById('loginDiv').style.display='none';
        document.getElementById('portal').style.display='block';
      })
      .catch(e=>alert(e.message));
    }
    function cikisYap(){auth.signOut();location.reload();}

    function showTab(id){
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('visible'));
      document.getElementById(id).classList.add('visible');
    }

    function kaydetSeker(){
      const user = auth.currentUser;
      db.collection("records").add({
        uid:user.uid,
        glucose:document.getElementById('glucose').value,
        note:document.getElementById('note').value,
        createdAt:new Date()
      }).then(()=>{listeleSeker();});
    }
    function listeleSeker(){
      const user = auth.currentUser;
      db.collection("records").where("uid","==",user.uid).get().then(snap=>{
        let out=""; snap.forEach(doc=>{let d=doc.data(); out+=`<div class='record'>${d.createdAt.toDate()} - ${d.glucose} mg/dl (${d.note})</div>`;});
        document.getElementById('sekerList').innerHTML=out;
      });
    }

    function kaydetForm(scale){
      const user = auth.currentUser;
      const form=document.getElementById(scale=="Tanıtıcı"?"taniticiForm":(scale=="DÖYS"?"doysForm":"ddsForm"));
      const data={};[...form.elements].forEach(el=>{if(el.name)data[el.name]=el.value;});
      db.collection("forms").add({
        uid:user.uid, scale:scale, answers:data, createdAt:new Date()
      }).then(()=>{listeleForm(scale);});
    }

    function listeleForm(scale){
      const user = auth.currentUser;
      db.collection("forms").where("uid","==",user.uid).where("scale","==",scale).get().then(snap=>{
        let out=""; snap.forEach(doc=>{let d=doc.data(); out+=`<div class='entry'>${d.createdAt.toDate()} - Cevaplar: ${JSON.stringify(d.answers)}</div>`;});
        document.getElementById(scale.toLowerCase()+"List").innerHTML=out;
      });
    }

  </script>
</body>
</html>
